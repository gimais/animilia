{% if user.is_authenticated %}
    <form class='comment-form' method='POST'>
        {% csrf_token %}
        {{comment_form.as_p|safe}}
        <button class="spoiler-button">სპოილერი</button>
        <button type='submit'>გაგზავნა</button>
    </form>
{% else %}
    {% block extra %}
        <style>
            .comments-box.clearfix:before {
                clear: both;
                margin-top: 10px;
            }
        </style>
    {% endblock %}
    <div class="no-auth">
        <p>კომენტარის გასაკეთებლად საჭიროა
            <a href="#login-focus" onclick="document.getElementsByClassName('login-form')[0].className += ' show'">ავტორიზაცია</a>,
            თუ არ ხართ ავტორიზებული შეგიძლიათ გაიაროთ <a href="{% url 'signup' %}">რეგისტრაცია</a>
        <p>
    </div>
{% endif %}

<div class="comments-box clearfix">
    {% for comment in comments %}
        {% with requester=user %}
        <div class="comment clearfix">
{#            <div class="admin"></div>#}
            <a class="comment-user-img" href="/profile/{{ comment.user_id }}/">
                <img src="/media/{{ comment.avatar }}" alt>
            </a>
            <div class="comment-body">
                <div class="comment-info">
                    <a class='comment-user {% if comment.user_id == requester.pk %}mine{% endif %}' href="/profile/{{ comment.user_id }}">{{ comment.username }}</a>
                {% if user.is_authenticated %}
                    {% if comment.user_id == requester.pk %}
                        {% if comment.like_count == 0 and comment.dislike_count == 0 and comment.replies_count == 0 %}
                        <div class="comment-right-buttons" id='edit-comment' style="color: #333333;"><i class="fas fa-edit"></i></div>
                        {% endif %}
                        <div class="comment-right-buttons" id='remove-comment' style="color: #333333;"><i class="fas fa-trash"></i></div>
                    {% endif %}
                    <p class="reply-button" data-id="{{comment.id}}" data-username="{{comment.username}}"><i class="fas fa-reply"></i>  პასუხი</p>
                {% endif %}
                {% endwith %}
                <div class="comment-dl-buttons">
                    <div class="comment-right-buttons" id='dislike-comment' style="color: #ab3717;"><i class="{% if comment.has_dislike  %}fas{% else %} far{% endif %} fa-thumbs-down"></i>{{ comment.dislike_count }}</div>
                    <div class="comment-right-buttons" id='like-comment' style="color: #ff2e01;" ><i class="{% if comment.has_like  %}fas{% else %} far{% endif %} fa-thumbs-up"></i>{{ comment.like_count }}</div>
                </div>
                    <p class='comment-time'>{{ comment.created|date:"d/m/Y | H:i" }}</p>
                </div>
                    <p style="word-break: break-word;">
                            {{ comment.body}}
                    </p>
            </div>
            {% if comment.replies_count %}
            <div class="comment-replies-check closed" data-id="{{comment.id}}">
                პასუხების ჩვენება ({{comment.replies_count}})
            </div>
                <div class="comment-replies-box" style="display: none"></div>
            {% endif %}
        </div>
    {% endfor %}
</div>
{% if comments.has_next %}
<div class="showmore" data-page="1" data-max="{{ max_page }}">მეტი</div>
{% endif %}